#!/bin/sh
# -*- coding: utf-8 -*-
# Copyright (C) 2012, 2013, 2014 Laboratoire de Recherche et
# DÃ©veloppement de l'Epita (LRDE).
#
# This file is part of Spot, a model checking library.
#
# Spot is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# Spot is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
# or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public
# License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

. ./defs
set -e

test -z "$PYTHON" && exit 77

ltl2tgba=../../bin/ltl2tgba

cat >formulas.txt <<EOF
GFa & GFb
GFa -> GFb
EOF

../../bin/ltlcross -f '!(GFa -> GFb)' -fXXGa -f0 "$ltl2tgba -s %s>%N" \
                   --universal --csv=output.csv

cat >test.py <<EOF
import sys
try:
  import pandas
except ImportError:
  sys.exit(77)

x = pandas.read_csv("output.csv")
print(x.filter(('states', 'transitions',
                'trim_states', 'trim_transitions',
                'product_states','product_transitions',
                'product_trim_states','product_trim_transitions')))
EOF

# will exit 77 if panda is not installed
$PYTHON test.py >out.1

# remove trailing whitespace from pandas' output,
# and limit to 13 lines, because Pandas 0.13 adds
# the size of the dataframe afterwards, but not
# older versions.
sed 's/[ \t]*$//g;15q' <out.1 > py.out

cat >expected <<\EOF
   states  transitions  trim_states  trim_transitions  product_states  \
0       3            9            3                 9               7
1       4           18            4                18              11
2       3            5            1                 1               5
3       4            8            2                 4               7
4       1            0            1                 0               1
5       1            1            1                 1               1

   product_transitions  product_trim_states  product_trim_transitions
0                   29                    6                        24
1                   60                   10                        52
2                    8                    1                         1
3                   14                    3                         6
4                    0                    0                         0
5                    1                    1                         1
EOF

diff py.out expected

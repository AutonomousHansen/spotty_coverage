#! /bin/sh

# Make sure we do not install privated header, i.e., headers that
# declare unexported functions.  We catch these by checking for
# headers that have no SPOT_API occurrence, but that have an ssociated
# *.cc file.

set -e

rm -f failures

# Remove any trailing slash
INCDIR=${INCDIR%/}

for file in `find "$INCDIR" \( -name "${1-*}.hh" \
                               -o -name "${1-*}.hxx" \) \
                  -a -type f -a -print | sed "s,$INCDIR/,,g"`; do

   if grep SPOT_API "$INCDIR/$file" >/dev/null; then
      :
   elif test -f "$SRCDIR/${file%.*}.cc"; then
      echo "FAIL: $file -- no exported symbol, should this file be private?"
      echo "  $file" >> failures
   fi

done

if test -f failures; then
   echo "Failed files:"
   cat failures
   rm failures
   exit 1;
fi
